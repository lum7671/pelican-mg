!function(a){a.fn.tipuesearch=function(b){var c=a.extend({contentLocation:"tipuesearch/tipuesearch_content.json",contextBuffer:60,contextLength:60,contextStart:90,debug:!1,descriptiveWords:25,highlightTerms:!0,liveContent:"*",liveDescription:"*",minimumLength:3,mode:"static",newWindow:!1,show:9,showContext:!0,showRelated:!0,showTime:!0,showTitleCount:!0,showURL:!0,wholeWords:!0},b);return this.each(function(){function g(a){var b=location.search,c=new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(b)||[,""],d=c[1].replace(/\+/g,"%20");try{d=decodeURIComponent(d)}catch(e){d=unescape(d)}return d||null}function h(e,g){var i="",k=!1,l=!1,m=!0,n=0;found=[];var o=a("#tipue_search_input").val(),p=o.toLowerCase();p=a.trim(p),(p.match('^"')&&p.match('"$')||p.match("^'")&&p.match("'$"))&&(m=!1);var q=p.split(" ");if(m){p="";for(var r=0;r<q.length;r++){for(var s=!0,t=0;t<tipuesearch_stop_words.length;t++)q[r]==tipuesearch_stop_words[t]&&(s=!1,l=!0);s&&(p=p+" "+q[r])}p=a.trim(p),q=p.split(" ")}else p=p.substring(1,p.length-1);if(p.length>=c.minimumLength){if(m){if(g){for(var u=p,r=0;r<q.length;r++)for(var t=0;t<tipuesearch_replace.words.length;t++)q[r]==tipuesearch_replace.words[t].word&&(p=p.replace(q[r],tipuesearch_replace.words[t].replace_with),k=!0);q=p.split(" ")}for(var v=p,r=0;r<q.length;r++)for(var t=0;t<tipuesearch_stem.words.length;t++)q[r]==tipuesearch_stem.words[t].word&&(v=v+" "+tipuesearch_stem.words[t].stem);q=v.split(" ");for(var r=0;r<b.pages.length;r++){for(var w=0,x=b.pages[r].text,t=0;t<q.length;t++){if(c.wholeWords)var y=new RegExp("\\b"+q[t]+"\\b","gi");else var y=new RegExp(q[t],"gi");if(-1!=b.pages[r].title.search(y)){var z=b.pages[r].title.match(y).length;w+=20*z}if(-1!=b.pages[r].text.search(y)){var z=b.pages[r].text.match(y).length;w+=20*z}if(-1!=b.pages[r].tags.search(y)){var z=b.pages[r].tags.match(y).length;w+=10*z}if(-1!=b.pages[r].url.search(y)&&(w+=20),0!=w)for(var A=0;A<tipuesearch_weight.weight.length;A++)b.pages[r].url==tipuesearch_weight.weight[A].url&&(w+=tipuesearch_weight.weight[A].score);q[t].match("^-")&&(y=new RegExp(q[t].substring(1),"i"),(-1!=b.pages[r].title.search(y)||-1!=b.pages[r].text.search(y)||-1!=b.pages[r].tags.search(y))&&(w=0))}0!=w&&(found.push({score:w,title:b.pages[r].title,desc:x,url:b.pages[r].url}),n++)}}else for(var r=0;r<b.pages.length;r++){var w=0,x=b.pages[r].text,y=new RegExp(p,"gi");if(-1!=b.pages[r].title.search(y)){var z=b.pages[r].title.match(y).length;w+=20*z}if(-1!=b.pages[r].text.search(y)){var z=b.pages[r].text.match(y).length;w+=20*z}if(-1!=b.pages[r].tags.search(y)){var z=b.pages[r].tags.match(y).length;w+=10*z}if(-1!=b.pages[r].url.search(y)&&(w+=20),0!=w)for(var A=0;A<tipuesearch_weight.weight.length;A++)b.pages[r].url==tipuesearch_weight.weight[A].url&&(w+=tipuesearch_weight.weight[A].score);0!=w&&(found.push({score:w,title:b.pages[r].title,desc:x,url:b.pages[r].url}),n++)}if(0!=n){if(c.showTitleCount&&0==d){var B=document.title;document.title="("+n+") "+B,d++}if(k&&(i+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+p+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+u+"</a></div>"),1==n?i+='<div id="tipue_search_results_count">'+tipuesearch_string_4:(c_c=n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),i+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5),c.showTime){var C=(new Date).getTime(),D=(C-startTimer)/1e3;i+=" ("+D.toFixed(2)+" "+tipuesearch_string_14+")",c.showTime=!1}i+="</div>",found.sort(function(a,b){return b.score-a.score});for(var E=0,r=0;r<found.length;r++){if(E>=e&&E<c.show+e){if(i+='<div class="tipue_search_content_title"><a href="'+found[r].url+'"'+f+">"+found[r].title+"</a></div>",c.debug&&(i+='<div class="tipue_search_content_debug">Score: '+found[r].score+"</div>"),c.showURL){var F=found[r].url.toLowerCase();0==F.indexOf("http://")&&(F=F.slice(7)),i+='<div class="tipue_search_content_url"><a href="'+found[r].url+'"'+f+">"+F+"</a></div>"}if(found[r].desc){var G=found[r].desc;if(c.showContext){q=p.split(" ");var H=found[r].desc.toLowerCase().indexOf(q[0]);if(H>c.contextStart){var I=G.substr(H-c.contextBuffer),J=I.indexOf(" ");I=G.substr(H-c.contextBuffer+J),I=a.trim(I),I.length>c.contextLength&&(G="... "+I)}}if(m){q=p.split(" ");for(var t=0;t<q.length;t++)if(c.highlightTerms){var K=new RegExp("("+q[t]+")","gi");G=G.replace(K,'<span class="h0011">$1</span>')}}else if(c.highlightTerms){var K=new RegExp("("+p+")","gi");G=G.replace(K,'<span class="h0011">$1</span>')}var L="",M=G.split(" ");if(M.length<c.descriptiveWords)L=G;else for(var t=0;t<c.descriptiveWords;t++)L+=M[t]+" ";L=a.trim(L),"."!=L.charAt(L.length-1)&&(L+=" ..."),L=L.replace(/h0011/g,"tipue_search_content_bold"),i+='<div class="tipue_search_content_text">'+L+"</div>"}}E++}if(c.showRelated&&m){t=0;for(var r=0;r<tipuesearch_related.searches.length;r++)p==tipuesearch_related.searches[r].search&&(k&&(o=p),t||(i+='<div class="tipue_search_related_title">'+tipuesearch_string_15+' <span class="tipue_search_related_bold">'+o+'</span></div><div class="tipue_search_related_cols">'),i+='<div class="tipue_search_related_text"><a class="tipue_search_related" id="'+tipuesearch_related.searches[r].related+'">',tipuesearch_related.searches[r].before&&(i+='<span class="tipue_search_related_before">'+tipuesearch_related.searches[r].before+"</span> "),i+=tipuesearch_related.searches[r].related,tipuesearch_related.searches[r].after&&(i+=' <span class="tipue_search_related_after">'+tipuesearch_related.searches[r].after+"</span>"),i+="</a></div>",t++);t&&(i+="</div>")}if(n>c.show){var N=Math.ceil(n/c.show),O=e/c.show;if(i+='<nav><div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',e>0&&(i+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="b" id="'+(e-c.show)+"_"+g+'">'+tipuesearch_string_6+"</a></li>"),O<=2){var P=N;N>3&&(P=3);for(var t=0;t<P;t++)i+=t==O?'<li class="current" role="navigation">'+(t+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+t*c.show+"_"+g+'">'+(t+1)+"</a></li>"}else{var P=O+2;P>N&&(P=N);for(var t=O-1;t<P;t++)i+=t==O?'<li class="current" role="navigation">'+(t+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+t*c.show+"_"+g+'">'+(t+1)+"</a></li>"}O+1!=N&&(i+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="m" id="'+(e+c.show)+"_"+g+'">'+tipuesearch_string_7+"</a></li>"),i+="</ul></div></nav>"}}else i+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else l?i+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(i+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",i+=1==c.minimumLength?'<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":'<div id="tipue_search_warning">'+tipuesearch_string_12+" "+c.minimumLength+" "+tipuesearch_string_13+"</div>");a("#tipue_search_content").hide().html(i).slideDown(200),a("#tipue_search_replaced").click(function(){h(0,!1)}),a(".tipue_search_related").click(function(){a("#tipue_search_input").val(a(this).attr("id")),h(0,!0)}),a(".tipue_search_foot_box").click(function(){var b=a(this).attr("id"),c=b.split("_");h(parseInt(c[0]),c[1])})}var b={pages:[]};a.ajaxSetup({async:!1});var d=0;if(a("#tipue_search_content").hide().html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>').show(),"live"==c.mode)for(var e=0;e<tipuesearch_pages.length;e++)a.get(tipuesearch_pages[e]).done(function(d){var f=a(c.liveContent,d).text();f=f.replace(/\s+/g," ");var g=a(c.liveDescription,d).text();g=g.replace(/\s+/g," ");var h=d.toLowerCase().indexOf("<title>"),i=d.toLowerCase().indexOf("</title>",h+7);if(-1!=h&&-1!=i)var j=d.slice(h+7,i);else var j=tipuesearch_string_1;b.pages.push({title:j,text:g,tags:f,url:tipuesearch_pages[e]})});"json"==c.mode&&a.getJSON(c.contentLocation).done(function(c){b=a.extend({},c)}),"static"==c.mode&&(b=a.extend({},tipuesearch));var f="";c.newWindow&&(f=' target="_blank"'),g("q")&&(a("#tipue_search_input").val(g("q")),h(0,!0)),a(this).keyup(function(a){"13"==a.keyCode&&h(0,!0)})})}}(jQuery);
